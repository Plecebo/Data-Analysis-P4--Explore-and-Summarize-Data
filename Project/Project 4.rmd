---
title: "Project 4"
author: "Larry Schwerzler"
date: "November 21, 2015"
output: html_document
---
# Introduction

For this project I chose to work witht he 2016 presidential campaign finance data, I am very much interested in the link between candidates and campagin finance and would like to see big money out of politics for various reasons. This gives me a personal interest in the data, which will hopefully help me to find real insight in what I'm looking at. 

# Front matter

I obtained the data from the FEC.gov website here: http://fec.gov/disclosurep/pnational.do on November 21, 2015.  I downloaded the entire dataset, in order to give me the most data to work with. My intent is to subset this data into smaller more workable sets. I downloaded the file and put the csv in the same folder as my .rmd file for ease of access. I named the file 2016Presidential_Election_Contributions.csv for clarity. 

Let's load some libraries into R that I will make use of through this analysis. 

```{r, echo=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
```

# Getting familiar with the data

This is a big dataset and the first step is to figure out what all is contained in it. 

```{r}
#ec <- read.csv('2016Presidential_Election_Contributions.csv') # gave errors
ec <- read.csv('2016Presidential_Election_Contributions.csv', row.names = NULL)
colnames(ec) <- c(colnames(ec)[-1],"x")
ec$x <- NULL
```

Right away I ran into an issue, I got an error message telling me duplicate row.names are not allowed. A quick google search brought me to this page: http://stackoverflow.com/questions/13239639/duplicate-row-names-error-reading-table-row-names-null-shifts-columns which lead me to formatting the read.csv command as above in the uncommented section as well as adding the two subsequent lines to shift the column names and remove the last column. 

## Data Set Statistics

After loading the dataset we can see there are 384,885 observations of 18 variables. 15 of the variables were identified at import as factors 1 contained chr data, 1 contained num data, 1 contained int data. 
Here are the variables: 

```{r}
names(ec)
```

Of particular interest are:

* cand_*- which seem to correspond to the candidate recieving the donations
* contbr_*- which seem to correspond to the particular contributor 
* contb_* which seems to correspond the the actual contribution
* election_tp- which looks at first glace to be an idiciation for which election the contribution is for

Here are the list of all 21 candidates:

```{r}
unique(ec$cand_nm)
```

No surprises here, and some basic statistics about the contribution amounts: 

```{r}
summary(ec$contb_receipt_amt)
```

Some surprising things here: 

* min contributions are negative, indicating this includes refunds to candidates
* the max is almost $87k, which right away to me indicated this was only for personal contributions to candidates. A quick dig on the FEC.gov site and that was confirmed, this information is just for those contributing directly to the candidates, it doesn not include contributions by companies or PAC groups. A disapointment, as I'd love to see similar stats for the PAC groups, but this is a great dataset to dip my toe into the water with.  
* a large difference between the mean and median

## Let's add some stuff

Right off the batt I know I will want to add Part (Dem/Rep/Ind) as well as Gender (M/F) to my data, so lets do that right away. 

```{r}
female_candidates <- c('Clinton, Hillary Rodham', 'Fiorina, Carly')
democratic_candidates <- c('Clinton, Hillary Rodham','Sanders, Bernard', "O'Malley, Martin Joseph","Webb, James Henry Jr.", "Lessig, Lawrence")
ec$gender <- ifelse(ec$cand_nm %in% female_candidates, 'Female', 'Male')
ec$party <- ifelse(ec$cand_nm %in% democratic_candidates, 'Democrat', 'Republican')
```

That is better, honestly I'm somewhat surprised this wasn't included in the dataset. 

## First look at the data

I am chomping at the bit to see what this data looks like, and one of the main factors is the contribution amounts. 

```{r}
ggplot(aes(x=contb_receipt_amt), data = ec) + geom_histogram(binwidth=100) 
```

This is a bit crazy, the chart shows, what the summary staistics indicated, that the data is a bit spread out. 

Let's try to filter things down a bit. 

```{r}
ggplot(aes(x=contb_receipt_amt), data = subset(ec, contb_receipt_amt > 0)) + 
  geom_histogram(binwidth=50) + xlim(0,quantile(ec$contb_receipt_amt, .9))
```

Now this is better. Here we are looking just at contributions > 0 and under the 90% statistic for donations. You can also see, clearly that the most contricutions come in the first few hundred dollars, with some notable spikes around $500 and $1000. 

I wonder if the same is true of returned contributions?

```{r}
ggplot(aes(x=contb_receipt_amt), data = subset(ec, contb_receipt_amt < 0)) + 
  geom_histogram(binwidth=50) + xlim(-5000,0)
```

Interesting that the negative contributions have a different shape to the histogram thent he positive contributions. I wonder why there is such a huge spike of negative contributions around -$2,700. Very curious. 

How about contributions  by candidate? 

```{r}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = sum) 
```

This is difficlt to read because of the names of the candidates being so long, it is hard to tell which corresponds to which. 

```{r}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = sum) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Alright! Easy to see now that Clinton has recieved the bulk of donations in terms of sheer dollars, followed by Bush, Cruz, Carson, Rubio, and Sanders in that order. Well that is total dollar contributions, way to go Hillary!, what about average contribution amount? 

```{r}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = mean) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Oh a much more even playing field. Here Jindal jumps to the top of the charts, pulling in nearly 2k on average per donation, that seems like a lot per donation. He is Followed closely by Christi, Bush and Pitaki. Interesting to me are the people at the bottom of this list. If a candidate has small average contributions, but has raised a lot of money we can assume that lots of people are donating, which for any politician is a good thing. Candidates in this camp are notably Sanders and Carson, with Cruz and Paul close behind. 

Let's take a look at number of contributions then. 

```{r}
ggplot(aes(x=cand_nm), data=ec) + 
  geom_histogram(binwidth=1)+ 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Interesting to see here that Clinton again is the leader in the sheer number of contributions. The next 3 highest in number of contributors are Carson, Sanders, and Cruz. This group dominates the rest of the candidates in sheer number of contributions. 

What about Democrats vs. Republicans? Who has raised more money? 

```{r}
ggplot(aes(x=party, y=contb_receipt_amt/1000000), data=ec) + 
  geom_bar(stat="summary", fun.y = sum) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

This is in millions of dollars. So Dems are just under $75M and looks like Republicans are around $93M. 

Who overall is getting more money per donation? My guess would be demograts, since Clinton has been at the top of those charts and there are so fewer Dems to republicans. 

```{r}
ggplot(aes(x=party, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = mean) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

My guess was right but not by as much as I would have expected.

What about donations over time?

```{r}
ggplot(aes(x=contb_receipt_dt, y=contb_receipt_amt), data=ec) +
  geom_line(aes(color=cand_nm), stat="summary", fun.y= sum)
```

Oops that didn't give at all what I expected. I wonder if the contb_receipt_dt field needs to be converted into a date? 

```{r}

ec$contb_receipt_dt <- as.Date(ec$contb_receipt_dt, "%d-%b-%y")
```

There we go all date like. Let's try the plot again. 

```{r}
ggplot(aes(x=contb_receipt_dt, y=contb_receipt_amt), data=ec) +
  geom_area(aes(color=cand_nm), stat="summary", fun.y= sum)
```

Much better, but too much information. Let's see what our date bounds are. 
```{r}
min(ec$contb_receipt_dt)
max(ec$contb_receipt_dt)
```

Looks like this dataset only goes through to September 30th, 2015 and starts with contributions all the way back to 2013. 

Let's just look at since March of 2015.


```{r}
ggplot(aes(x=contb_receipt_dt, y=contb_receipt_amt), 
       data= subset(ec, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_area(aes(color=cand_nm), stat="summary", fun.y= sum)
```

This is better, but I think the graph just doesn't quite look right, it doesn't make sense that the total dollars would fluctuate up and down like that I think this isn't showing a proper cumulative summary like I was expecting, but a sum of each candidates donations on each date. 

I had a really hard time coming up with the right way to do this just using ggplot, in the end I created another dataframe and grouped the data by candidate,and date and summed the contributions on that date, then cumulatively summed them, then used that dataframe in the ggplot viola! Credit to this site for helping me break through that challenge. http://www.markhneedham.com/blog/2014/08/31/r-ggplot-cumulative-frequency-graphs/ I tried lots of stuff, but this was the one that helped me get on the right path. 

```{r}
ec.day_group <- ec %>% group_by(party, cand_nm, contb_receipt_dt) %>% summarize(daily_contributions = sum(contb_receipt_amt), n = n()) %>% mutate(daily_contributions = cumsum(daily_contributions), n = cumsum(n)) 
ggplot(aes(x=contb_receipt_dt, y=daily_contributions/100000), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_line(aes(color=cand_nm))
```

Look at Hillary shoot up, wow!
What about dems vs republicans, lets add a facet

```{r}
ggplot(aes(x=contb_receipt_dt, y=daily_contributions/100000), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_line(aes(color=cand_nm)) + 
  facet_wrap(~party)
```

Man the Republican contributions are much more competitive within the party, the dems are dominated by Clinton. 

What about the same breakdown but for number of donations total? 

```{r}
ggplot(aes(x=contb_receipt_dt, y=n), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_line(aes(color=cand_nm)) + 
  facet_wrap(~party)
```

Two big superstars from each group here. Clinton/Sanders, and Cruz/Carson. 

Let's take a look at how the debates impacted number of donations to the candidates. 

```{r}
ggplot(aes(x=contb_receipt_dt, y=n), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-08-01"))) +
  geom_line(aes(color=cand_nm)) +
  geom_vline(xintercept = as.numeric(as.Date("2015-08-06")), colour = "red")+
  geom_vline(xintercept = as.numeric(as.Date("2015-09-16")), colour = "red")
```

Since the dataset only goes through September 30, 2015 we can only include the two Republican debates that happened prior to this date, and none of the Democratic debates. 

Let's focus on the republicans around the first debate on August 6, 2015

```{r}
ggplot(aes(x=contb_receipt_dt, y=n), 
       data= subset(ec.day_group, 
                    contb_receipt_dt >= as.Date("2015-07-15") &  
                      contb_receipt_dt <= as.Date("2015-08-15") &
                      party == 'Republican'
                    )) +
  geom_line(aes(color=cand_nm)) +
  geom_vline(xintercept = as.numeric(as.Date("2015-08-06")), colour = "red")
```





# Final Plots and Summary
You will select three plots from your analysis to polish and share in this section. The three plots should show different trends and should be polished with appropriate labels, units, and titles (see the Project Rubric for more information).

# Reflection
This should contain a few sentences about your struggles, successes, and ideas for future exploration on the data set (see the Project Rubric for more information).







