---
title: "Project 4"
author: "Larry Schwerzler"
date: "November 21, 2015"
output: html_document
---
# Introduction

For this project I chose to work witht he 2016 presidential campaign finance data, I am very much interested in the link between candidates and campagin finance and would like to see big money out of politics for various reasons. This gives me a personal interest in the data, which will hopefully help me to find real insight in what I'm looking at. 

# Front matter

I obtained the data from the FEC.gov website here: http://fec.gov/disclosurep/pnational.do on February 22, 2016.  I downloaded the entire dataset, in order to give me the most data to work with. My intent is to subset this data into smaller more workable sets. I downloaded the file and put the csv in the same folder as my .rmd file for ease of access. I named the file 2016Presidential_Election_Contributions.csv for clarity. 

Let's load some libraries into R that I will make use of through this analysis. 

```{r, echo=FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
```

# Getting familiar with the data

This is a big dataset and the first step is to figure out what all is contained in it. 

```{r}
#ec <- read.csv('2016Presidential_Election_Contributions.csv') # gave errors
ec <- read.csv('2016Presidential_Election_Contributions.csv', row.names = NULL)
colnames(ec) <- c(colnames(ec)[-1],"x")
ec$x <- NULL
```

Right away I ran into an issue, I got an error message telling me duplicate row.names are not allowed. A quick google search brought me to this page: http://stackoverflow.com/questions/13239639/duplicate-row-names-error-reading-table-row-names-null-shifts-columns which lead me to formatting the read.csv command as above in the uncommented section as well as adding the two subsequent lines to shift the column names and remove the last column. 

## Data Set Statistics

After loading the dataset we can see there are 1,170,160 observations of 18 variables. 15 of the variables were identified at import as factors 1 contained chr data, 1 contained num data, 1 contained int data. 
Here are the variables: 

```{r}
names(ec)
```

Of particular interest are:

* cand_*- which seem to correspond to the candidate recieving the donations
* contbr_*- which seem to correspond to the particular contributor 
* contb_* which seems to correspond the the actual contribution
* election_tp- which looks at first glace to be an idiciation for which election the contribution is for

Here are the list of all 22 candidates:

```{r}
unique(ec$cand_nm)
```

No surprises here, and some basic statistics about the contribution amounts: 

```{r}
summary(ec$contb_receipt_amt)
```

Some surprising things here: 

* min contributions are negative, indicating this includes refunds to candidates
* the max is almost $1.8 million, which is a red flag. If you look on the FEC website, there is a $2,700 limit to the amount an individual can contribute to a candidate. Source: http://www.fec.gov/info/contriblimitschart1516.pdf. This indicates that there are nuanced ways to contribute, but still the largest possible amount for a single contribution is for $100K which is way less then the $1.8 million seen as the large donations. I'll want to take a look at this straight away.
* a large difference between the mean and median

## Let's add some stuff

I know I will want to add Party (Dem/Rep/Green) as well as Gender (M/F) to my data, so lets do that right away. 

```{r}
female_candidates <- c('Clinton, Hillary Rodham', 'Fiorina, Carly', 'Stein, Jill')
democratic_candidates <- c('Clinton, Hillary Rodham','Sanders, Bernard', "O'Malley, Martin Joseph","Webb, James Henry Jr.", "Lessig, Lawrence")
green_party_candidates <- c('Stein, Jill')
ec$gender <- ifelse(ec$cand_nm %in% female_candidates, 'Female', 'Male')
ec$party <- ifelse(ec$cand_nm %in% democratic_candidates, 'Democrat', ifelse(ec$cand_nm %in% green_party_candidates, 'Green','Republican'))
ec$gender <- as.factor(ec$gender)
ec$party <- as.factor(ec$party)
```

That is better, honestly I'm somewhat surprised this wasn't included in the dataset. 

## First look at the data

I am chomping at the bit to see what this data looks like, and one of the main factors is the contribution amounts. 

```{r}
ggplot(aes(x=contb_receipt_amt), data = ec) + geom_histogram(binwidth=100) 
```

This is a bit crazy, the chart shows, what the summary staistics indicated, that the data is a bit spread out. 

Let's try to filter things down a bit. 

```{r}
ggplot(aes(x=contb_receipt_amt), data = subset(ec, contb_receipt_amt > 0)) + 
  geom_histogram(binwidth=50) + xlim(0,quantile(ec$contb_receipt_amt, .9))
```

Now this is better. Here we are looking just at contributions > 0 and under the 90% statistic for donations. You can also see, clearly that the majority of contributions come in the first few hundred dollars. 

I wonder if the same is true of returned contributions?

```{r}
ggplot(aes(x=contb_receipt_amt), data = subset(ec, contb_receipt_amt < 0)) + 
  geom_histogram(binwidth=50) + xlim(-5000,0)
```

Interesting that the negative contributions have a different shape to the histogram then the positive contributions. I wonder why there is such a huge spike of negative contributions around -$2,700. My guess would be that people might have mistakenly contributed or been charged twice for a maximum contribution, and subsequent contributions were refunded. This seems reasonable considing $2,700 is the max personal contribution amount by individuals. 

## What about those high dollar and negative contributions? What are those about? 

I had to find out so lets take a look at the top 10 negative dollar contributions

```{r}
head(ec[order(ec$contb_receipt_amt),
        c("cand_nm","contbr_nm", "contbr_employer", "contb_receipt_amt", "contb_receipt_dt", "memo_text", "receipt_desc")],
     n=10)
```

This list shows the largest 10 negative contribution amounts. I limited the columns so that the cruff was removed in hopes to have some light shed on the issue of where these contributions came from and gain some insight into how they might come about. 

The top negative contribution was for an Ernie Boch who was refunded $84,236.80 from Trump. A quick google search shows this result relating to the incident: http://www.boston.com/news/local/massachusetts/2015/10/15/ernie-boch-tried-donate-way-way-too-much-money-donald-trump-gets-refunded/1QhFWWAIzyyK4Jc79xB5aO/story.html which indicates that Boch made contributions in kind to the Trump campaign in the form of paying for catering at an event for Trump, the amount exceded the contribution limit as set forth by the FEC and the result was a refund issued to Boch for "$84,236.80" which matches perfectly the amount I was investigating. 

What other contriutions has Boch made? 

```{r}
subset(ec[, c("cand_nm","contbr_nm", "contbr_employer", "contb_receipt_amt", "contb_receipt_dt", "memo_text", "receipt_desc")], ec$contbr_nm == 'BOCH, ERNIE')
```

One Donation for $86,936.80 and one refund for $84,236.80 which is a difference of 
```{r}
86936.80 - 84236.80
```

Which is the personal contribution limit for a person to give to a candidate. Checks out.

That explains the biggest, what about the next? Using Similar research methods I discovered that Dr. Thomas Gocke donated $20,000 to Clinton on 6/29/2015 and as per the filing here: http://docquery.fec.gov/cgi-bin/fecimg/?201509039001609936 was refunded that money on 6/30/2015. 

```{r}
subset(ec[, c("cand_nm","contbr_nm", "contbr_employer", "contb_receipt_amt", "contb_receipt_dt", "memo_text", "receipt_desc")], ec$contbr_nm == 'GOCKE, THOMAS DR.')
```

uhhh only one listed, strange. Maybe his name is listed differently someplace else?

```{r}
subset(ec[, c("cand_nm","contbr_nm", "contbr_employer", "contb_receipt_amt", "contb_receipt_dt", "memo_text", "receipt_desc")], grepl(glob2rx("GOCKE, THOMAS*") , ec$contbr_nm) )
```

Thanks to this resource for explaining the usage of fuzzy matching with grepl and glob2rx: http://stackoverflow.com/questions/5823503/pattern-matching-using-a-wildcard

As I suspected he was a Dr when he was refunded but not a Dr when he donated. 

So it looks like those are explained pretty well, I will assume that those negative contributions corresponde to overpayment type contributions. 

What about the BIG donations?

```{r}
head(ec[order(-ec$contb_receipt_amt),
        c("cand_nm","contbr_nm", "contbr_employer", "contb_receipt_amt", "contb_receipt_dt", "memo_text", "receipt_desc")],
     n=10)
```

Some of these large contributions come from PAC groups. The largest 3 donations came from Hillary Victory Fund in the total of:

```{r}
1797624.9 + 1603724.4 + 1467070.9
```

Wow, lots of money for Clinton from that PAC. 

The other large donations look like they are from other PAC's (LLC, LLP, etc) or are set to be refunded as overpayments. Including Dr (sometimes) Thomas Gocke. 

From what I can tell there doesn't seem to be a good way to identify the PAC vs Individual donations to various candidates from the data. Something more advanced might be able to be developed but there is nothing that is given to us that tells us this. That is a shame. 

## Back to looking at contributions

How about contributions  by candidate? 

```{r}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = sum) 
```

This is difficlt to read because of the names of the candidates being so long, it is hard to tell which corresponds to which. 

```{r}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = sum) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Alright! Easy to see now that Clinton has recieved the bulk of donations in terms of sheer dollars, followed by Cruz,Bush,Rubio, and Sanders in that order. Well that is total dollar contributions, way to go Hillary!, what about average contribution amount? 

```{r}
ggplot(aes(x=cand_nm, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = mean) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Oh a much more even playing field. Here Jindal jumps to the top of the charts, pulling in something like $1,200 on average per donation, that seems like a lot per donation. He is Followed closely by Pitaki, Christi, and Perry. Interesting to me are the people at the bottom of this list. If a candidate has small average contributions, but has raised a lot of money we can assume that lots of people are donating, which for any politician is a good thing. Candidates in this camp are notably Sanders and Carson, with Cruz and Paul close behind. 

Let's take a look at number of contributions then. 

```{r}
ggplot(aes(x=cand_nm), data=ec) + 
  geom_histogram(binwidth=1)+ 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

Here we see Sanders with many more donations than the other candidates. Interesting to see here that Clinton again is the leader in the sheer number of contributions. The next 3 highest in number of contributors are Clinton, Cruz and Carson. This group dominates the rest of the candidates in sheer number of contributions. 

What about Democrats vs. Republicans vs Green? Who has raised more money? 

```{r}
ggplot(aes(x=party, y=contb_receipt_amt/1000000), data=ec) + 
  geom_bar(stat="summary", fun.y = sum) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

This is in millions of dollars. So Dems are around $130M and looks like Republicans are around $155M. 

Who overall is getting more money per donation? My guess would be democrats, since Clinton has been at the top of those charts and there are so fewer Dems to republicans. 

```{r}
ggplot(aes(x=party, y=contb_receipt_amt), data=ec) + 
  geom_bar(stat="summary", fun.y = mean) + 
  theme(axis.text.x = element_text(angle = 90, hjust = 1))
```

My guess was not correct. Dems get about $240 per donation Republicans get $270 or so. The Green party lags behind with something in the $210 range.

What about donations over time?

```{r}
ggplot(aes(x=contb_receipt_dt, y=contb_receipt_amt), data=ec) +
  geom_line(aes(color=cand_nm), stat="summary", fun.y= sum)
```

Oops that didn't give at all what I expected. I wonder if the contb_receipt_dt field needs to be converted into a date? 

```{r}

ec$contb_receipt_dt <- as.Date(ec$contb_receipt_dt, "%d-%b-%y")
```

There we go all date like. Let's try the plot again. 

```{r}
ggplot(aes(x=contb_receipt_dt, y=contb_receipt_amt), data=ec) +
  geom_area(aes(color=cand_nm), stat="summary", fun.y= sum)
```

Much better, but too much information. Let's see what our date bounds are. 
```{r}
min(ec$contb_receipt_dt)
max(ec$contb_receipt_dt)
```

Looks like this dataset only goes through to January 31st, 2016 and starts with contributions all the way back to 2013. 

Let's just look at since March of 2015.


```{r}
ggplot(aes(x=contb_receipt_dt, y=contb_receipt_amt), 
       data= subset(ec, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_area(aes(color=cand_nm), stat="summary", fun.y= sum)
```

This is better, but I think the graph just doesn't quite look right, it doesn't make sense that the total dollars would fluctuate up and down like that I think this isn't showing a proper cumulative summary like I was expecting, but a sum of each candidates donations on each date. 

I had a really hard time coming up with the right way to do this just using ggplot, in the end I created another dataframe and grouped the data by candidate,and date and summed the contributions on that date, then cumulatively summed them, then used that dataframe in the ggplot viola! Credit to this site for helping me break through that challenge. http://www.markhneedham.com/blog/2014/08/31/r-ggplot-cumulative-frequency-graphs/ I tried lots of stuff, but this was the one that helped me get on the right path. 

```{r}
ec.day_group <- ec %>% group_by(party, cand_nm, contb_receipt_dt) %>% summarize(daily_contributions = sum(contb_receipt_amt), n = n()) %>% mutate(daily_contributions = cumsum(daily_contributions), n = cumsum(n)) 
ggplot(aes(x=contb_receipt_dt, y=daily_contributions/100000), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_line(aes(color=cand_nm))
```

Look at Hillary shoot up, wow!
What about dems vs republicans, lets add a facet

```{r}
ggplot(aes(x=contb_receipt_dt, y=daily_contributions/100000), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_line(aes(color=cand_nm)) + 
  facet_wrap(~party)
```

Man the Republican contributions are much more competitive within the party, the dems are dominated by Clinton. 

What about the same breakdown but for number of donations total? 

```{r}
ggplot(aes(x=contb_receipt_dt, y=n), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-03-01"))) +
  geom_line(aes(color=cand_nm)) + 
  facet_wrap(~party)
```

Two big superstars from each group here. Clinton/Sanders, and Cruz/Carson. 

Let's take a look at how the debates impacted number of donations to the candidates. My thinking being, did the debate have a significant impact on the minds of voters and where they are spending donations. 

```{r}
ggplot(aes(x=contb_receipt_dt, y=n), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-08-01"))) +
  geom_line(aes(color=cand_nm)) +
  geom_vline(xintercept = as.numeric(as.Date("2015-08-06")), colour = "red")+
  geom_vline(xintercept = as.numeric(as.Date("2015-09-16")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-10-13")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2015-10-28")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-11-10")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-11-14")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2015-12-15")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-12-19")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-14")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-17")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-28")), colour = "red") 

```

Since the dataset only goes through January 31st, 2016 this only includes debates that happened before than.  

What about the same info for total dollars? 
```{r}
ggplot(aes(x=contb_receipt_dt, y=daily_contributions/100000), 
       data= subset(ec.day_group, contb_receipt_dt >= as.Date("2015-08-01"))) +
  geom_line(aes(color=cand_nm)) +
  geom_vline(xintercept = as.numeric(as.Date("2015-08-06")), colour = "red")+
  geom_vline(xintercept = as.numeric(as.Date("2015-09-16")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-10-13")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2015-10-28")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-11-10")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-11-14")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2015-12-15")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2015-12-19")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-14")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-17")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-28")), colour = "red") 

```

Let's focus on the republicans around the debate on January 14, 2016

```{r}
ggplot(aes(x=contb_receipt_dt, y=n), 
       data= subset(ec.day_group, 
                    contb_receipt_dt >= as.Date("2016-01-01") &  
                      contb_receipt_dt <= as.Date("2016-01-31") &
                      party == 'Republican'
                    )) +
  geom_line(aes(color=cand_nm)) +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-14")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-17")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-28")), colour = "red")
```

I did some digging around and found a few sources (absolutely not an exhaustive search) surrounding this debate and the percieved winners. Here are some sources: 
*http://insider.foxnews.com/2016/01/14/frank-luntz-focus-group-picks-their-overwhelming-winner-fox-business-gop-debate
*http://www.cnn.com/2016/01/15/politics/republican-debate-2016-winners-losers/

Both sources agree that the candidates that did the best in the debate were Trump and Cruz. Trump has been on the low end of most of these graphs, not ever really getting very many donations or much money according to this data. Cruz on the other hand has been a frontrunner in many of the Republican charts. We see that there was a notable uptick in number of donations around the debate. Right before and right after Cruz enjoyed some upward movement on the number of collections he made. 

What about the dollars collected? 

```{r}
ggplot(aes(x=contb_receipt_dt, y=daily_contributions/100000), 
       data= subset(ec.day_group, 
                    contb_receipt_dt >= as.Date("2016-01-01") &  
                      contb_receipt_dt <= as.Date("2016-01-31") &
                      party == 'Republican'
                    )) +
  geom_line(aes(color=cand_nm)) +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-14")), colour = "red") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-17")), colour = "blue") +
  geom_vline(xintercept = as.numeric(as.Date("2016-01-28")), colour = "red")
```

Some surprising things here as we see what seems to be an increase in donation dollars to many candidates starting around Jan 4 and continuing until after the debate around the 15th or 16th of January. It is unclear what might be causing those steeper then average climbs during those periods or why they seem to level off. 






# Final Plots and Summary
You will select three plots from your analysis to polish and share in this section. The three plots should show different trends and should be polished with appropriate labels, units, and titles (see the Project Rubric for more information).

# Reflection
This should contain a few sentences about your struggles, successes, and ideas for future exploration on the data set (see the Project Rubric for more information).







